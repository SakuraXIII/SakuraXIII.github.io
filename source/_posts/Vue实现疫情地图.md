---
title: Vue实现新冠病毒疫情地图
date: 2020-02-10
tags: [Vue, 疫情地图]
category: [笔记, 瞎搞]
---



### 前言

没想到这次疫情居然如此严重，兄弟萌要注意安全啊。虽然03年的事没有印象，但是根据各方面的说法来看，貌似比非典还要严重。不过咱也不慌，毕竟咱只是个普通人，坚守在一线的人员们才是最值得关注的。

<!--more-->

![](/images/post/2019nCoV/nCoV.jpg)

前几天在掘金上看到的文章，觉得做的很好，在家又闲的慌，再加上Vue忘的差不多了，就打算复刻一份作者的地图，当做是练习，然后放在[Gitee](https://gitee.com/Tonyteachers/COVID-19)上面，企图获得Star。[线上示例](http://120.25.204.190/dist)

### Vue的旅程

#### 1、Typescript从入门到放弃

最近在学 ts，本来是打算用`ts+vue+elementUI+webpack`构建，结果 ts 还没掌握好，一直在报错，声明文件都有，但是总是会有不知所以然的错误，无奈只能降级成 js。

#### 2、webpack的学习到配置再到想砸键盘

花了一天时间看webpack文档，又花了一天时间配置webpack😂，感觉webpack好难啊。本来不想用babel，结果element按需加载需要babel配置文件，那就装咯，然后在element组件里使用图片，结果不显示图片，我就觉得是webpack配置的问题，于是边查文档边百度，弄了好几个小时也没解决，恨不得文件全删，不折腾了。

然后没办法，就把配置文件一点一点的改，最后发现是`webpack-dev-server`的`contentBase`被我设置了，这才明白这个属性是用来决定入口的目录的，要设置成自己在使用的`src`，我设置成了打包后的`dist`。

#### 3、echarts地图与回调地狱的形成

以前用过好几次echarts，大赞这个数据可视化库，太强了，这次来用它的地图组件。本着拒绝反复造轮子的原则，直接从网上找了一份差不多的示例。接着处理数据，数据来自腾讯新闻的接口，用`vue-axios`请求，一开始还出现了跨域，浏览器上可以正常GET到数据，代码使用API怎么就不行了，百度了解到这是JSONP和Ajax的区别。

可行的解决办法是给`webpack-dev-server`设置代理`proxy`属性并配置，不过我最后用的是第三方的[代理服务](https://bird.ioliu.cn/)。因为请求是异步，所以少不了回调函数，处理数据又用了好几个函数，反复回调。自己都搞不清楚`this`到底指到哪里去了，惨不忍睹。最后重构了一次，用es6的类的写法，把数据处理函数封装好全部在请求数据的回调里执行。

#### 4、Vue路由的监视

数据都处理好后，地图能正常显示，就开始打算实现点击显示对应省份下城市的数据，结果发现跳转了组件没有变化，然后看了文档后，想起来路由需要用`watch`或者导航守卫监视路由变化，否则组件会本着复用的原则，不会销毁重建。

### 总结

这个东西折腾了一个星期，基本功能都有了之后就上传不想管了，有的一些小bug在下也实在不想改了。。这次练习算是把前面学的一部分知识给回忆起来了。